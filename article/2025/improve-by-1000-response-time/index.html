<!doctype html><html dir=ltr lang=fr data-theme class="html theme--light"><head><meta charset=utf-8><title>Paul Leclercq ü¶ï
|
Scaling Smart: From 60s to 60ms response time with 0 added costs
</title><meta name=generator content="Hugo 0.142.0"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover"><meta name=author content="map[email:Paul Leclercq name:Paul Leclercq ü¶ï]"><meta name=description content="Fullstack Data, Culture DevOps, Ecoconception des services num√©riques, Formations"><meta name=robots content="noai, noimageai"><meta name=google-site-verification content="WE8cLCZlyZMgkYks0sRlw8vYQhJ0e5lirXSmize3NSc"><link rel=stylesheet href=/scss/main.min.874935554a645e34620d0235691cbebeda551ce44ffc697520a3c3d7bb6e106a.css integrity="sha256-h0k1VUpkXjRiDQI1aRy+vtpVHORP/Gl1IKPD17tuEGo=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/markupHighlight.min.73ccfdf28df555e11009c13c20ced067af3cb021504cba43644c705930428b00.css integrity="sha256-c8z98o31VeEQCcE8IM7QZ688sCFQTLpDZExwWTBCiwA=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/css/custom.min.4bacad85151a82831d3844fa18173d8368f69bb66d425925acc638939060151b.css integrity="sha256-S6ythRUagoMdOET6GBc9g2j2m7ZtQlklrMY4k5BgFRs=" crossorigin=anonymous media=screen><link rel=stylesheet href=/fontawesome/css/fontawesome.min.137b1cf3cea9a8adb7884343a9a5ddddf4280f59153f74dc782fb7f7bf0d0519.css integrity="sha256-E3sc886pqK23iENDqaXd3fQoD1kVP3TceC+3978NBRk=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/solid.min.e65dc5b48fb5f39b142360c57c3a215744c94e56c755c929cc3e88fe12aab4d3.css integrity="sha256-5l3FtI+185sUI2DFfDohV0TJTlbHVckpzD6I/hKqtNM=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/regular.min.6f4f16d58da1c82c0c3a3436e021a3d39b4742f741192c546e73e947eacfd92f.css integrity="sha256-b08W1Y2hyCwMOjQ24CGj05tHQvdBGSxUbnPpR+rP2S8=" crossorigin=anonymous type=text/css><link rel=stylesheet href=/fontawesome/css/brands.min.e10425ad768bc98ff1fb272a0ac8420f9d1ba22f0612c08ff1010c95080ffe7e.css integrity="sha256-4QQlrXaLyY/x+ycqCshCD50boi8GEsCP8QEMlQgP/n4=" crossorigin=anonymous type=text/css><link rel="shortcut icon" href=/favicons/favicon.ico type=image/x-icon><link rel=apple-touch-icon sizes=180x180 href=/favicons/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicons/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicons/favicon-16x16.png><link rel=canonical href=http://www.epauler.fr/article/2025/improve-by-1000-response-time/><script type=text/javascript src=/js/anatole-header.min.f9132794301a01ff16550ed66763482bd848f62243d278f5e550229a158bfd32.js integrity="sha256-+RMnlDAaAf8WVQ7WZ2NIK9hI9iJD0nj15VAimhWL/TI=" crossorigin=anonymous></script><script type=text/javascript src=/js/anatole-theme-switcher.min.d6d329d93844b162e8bed1e915619625ca91687952177552b9b3e211014a2957.js integrity="sha256-1tMp2ThEsWLovtHpFWGWJcqRaHlSF3VSubPiEQFKKVc=" crossorigin=anonymous></script><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="http://www.epauler.fr/images/2025/from-seconds-to-milliseconds.png"><meta name=twitter:title content="Scaling Smart: From 60s to 60ms response time with 0 added costs"><meta name=twitter:description content="Partitionning, caching and materialized views to save cost and improve performance custom full-scan SQL queries"><meta property="og:url" content="http://www.epauler.fr/article/2025/improve-by-1000-response-time/"><meta property="og:site_name" content="Paul Leclercq ü¶ï"><meta property="og:title" content="Scaling Smart: From 60s to 60ms response time with 0 added costs"><meta property="og:description" content="Partitionning, caching and materialized views to save cost and improve performance custom full-scan SQL queries"><meta property="og:locale" content="fr"><meta property="og:type" content="article"><meta property="article:section" content="article"><meta property="article:published_time" content="2025-05-04T12:50:07+02:00"><meta property="article:modified_time" content="2025-05-04T12:50:07+02:00"><meta property="og:image" content="http://www.epauler.fr/images/2025/from-seconds-to-milliseconds.png"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"article","name":"Scaling Smart: From 60s to 60ms response time with 0 added costs","headline":"Scaling Smart: From 60s to 60ms response time with 0 added costs","alternativeHeadline":"","description":"
      Partitionning, caching and materialized views to save cost and improve performance custom full-scan SQL queries


    ","inLanguage":"fr","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"http:\/\/www.epauler.fr\/article\/2025\/improve-by-1000-response-time\/"},"author":{"@type":"Person","name":"map[email:Paul Leclercq name:Paul Leclercq ü¶ï]"},"creator":{"@type":"Person","name":"map[email:Paul Leclercq name:Paul Leclercq ü¶ï]"},"accountablePerson":{"@type":"Person","name":"map[email:Paul Leclercq name:Paul Leclercq ü¶ï]"},"copyrightHolder":{"@type":"Person","name":"map[email:Paul Leclercq name:Paul Leclercq ü¶ï]"},"copyrightYear":"2025","dateCreated":"2025-05-04T12:50:07.00Z","datePublished":"2025-05-04T12:50:07.00Z","dateModified":"2025-05-04T12:50:07.00Z","publisher":{"@type":"Organization","name":{"email":"Paul Leclercq","name":"Paul Leclercq ü¶ï"},"url":"http://www.epauler.fr/","logo":{"@type":"ImageObject","url":"http:\/\/www.epauler.fr\/favicons\/favicon-32x32.png","width":"32","height":"32"}},"image":["http://www.epauler.fr/images/2025/from-seconds-to-milliseconds.png"],"url":"http:\/\/www.epauler.fr\/article\/2025\/improve-by-1000-response-time\/","wordCount":"748","genre":[],"keywords":[]}</script></head><body class=body><div class=wrapper><aside class=wrapper__sidebar><div class="sidebar
animated fadeInDown"><div class=sidebar__content><div class=sidebar__introduction><img class=sidebar__introduction-profileimage src="https://avatars.githubusercontent.com/u/4059615?v=4" alt="profile picture"><div class=sidebar__introduction-title><a href=/>Paul Leclercq ü¶ï</a></div><div class=sidebar__introduction-description><p>Torr√©facteur de data<br><hr><br>"Des nains sur des √©paules de g√©ants"<br>Bernard de Chartres<br></p></div></div><ul class=sidebar__list><li class=sidebar__list-item><a href=https://github.com/polomarcus target=_blank rel="noopener me" aria-label=Github title=Github><i class="fab fa-github fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://www.linkedin.com/in/paleclercq/ target=_blank rel="noopener me" aria-label=Linkedin title=Linkedin><i class="fab fa-linkedin fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://stackoverflow.com/users/3535853/paul-leclercq target=_blank rel="noopener me" aria-label=Stackoverflow title=Stackoverflow><i class="fab fa-stack-overflow fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://bsky.app/profile/epauler.fr target=_blank rel="noopener me" aria-label=Bluesky title=Bluesky><i class="fab fa-twitter fa-2x" aria-hidden=true></i></a></li><li class=sidebar__list-item><a href=https://www.epauler.fr/index.xml target=_blank rel="noopener me" aria-label=RSS title=RSS><i class="fa fa-rss fa-2x" aria-hidden=true></i></a></li></ul></div><footer class="footer footer__sidebar"><ul class=footer__list><li class=footer__item>&copy;
Copyleft (üÑØ) - CC-BY-SA</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W1N7B2KENY"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W1N7B2KENY")</script></div></aside><main class=wrapper__main><header class=header><div class="animated fadeInDown"><a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false><span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span>
<span aria-hidden=true class=navbar-burger__line></span></a><nav class=nav><ul class=nav__list id=navMenu><li class=nav__list-item><a href=/ title>√âpaulons-nous</a></li><li class=nav__list-item><a href=/article/ title>üìñ Blog</a></li><li class=nav__list-item><a href=/presse/ title>üì∫ Dans la presse</a></li><li class=nav__list-item><a href=/mes_ressources/ title>üîó Mes ressources</a></li></ul><ul class="nav__list nav__list--end"><li class=nav__list-item><div class=themeswitch><a title="Switch Theme"><i class="fas fa-adjust fa-fw" aria-hidden=true></i></a></div></li></ul></nav></div></header><div class="post
animated fadeInDown"><div class=post__thumbnail-wrapper><img class=post__thumbnail src=/images/2025/from-seconds-to-milliseconds.png alt="Thumbnail image"></div><div class=post__content><h1>Scaling Smart: From 60s to 60ms response time with 0 added costs</h1><ul class=post__meta><li class=post__meta-item><em class="fas fa-calendar-day post__meta-icon"></em>
<span class=post__meta-text>04/05/2025</span></li><li class=post__meta-item><em class="fas fa-stopwatch post__meta-icon"></em>
<span class=post__meta-text>4 minutes de lecture</span></li></ul><p>For the <a href=https://observatoiremediaecologie.fr/>Ecology Media Observatory</a>, a project I‚Äôve been working on for over a year, with features like misinformation detection or being able to deep dive into the observatory&rsquo;s data, I struggled to find time to improve the site‚Äôs performance for rare and custom full-scan queries ‚Äî <a href=https://www.epauler.fr/article/2025/blog-observatoire-des-medias-scaleway/>especially given a tight infrastructure budget.</a></p><h2 id=initial-caching-strategy-using-metabase-and-slack>Initial caching strategy using Metabase and Slack</h2><p>The observatory displays a lot of graphs. And for performance, I&rsquo;ve relied on cache for the website&rsquo;s full-scan queries with automatic pre-warm up requests from a slack bot to refresh them.</p><p>I implemented this solution pretty quickly thanks to <a href=https://www.metabase.com/docs/latest/data-modeling/model-persistence>Metabase persistence model</a>, and Metabase slack alerts.</p><p>It was good enough for me, but for more (rare) curious users that customize some full-scan queries, they couldn&rsquo;t use the cache and had to wait about a minute for results, and in today&rsquo;s too fast world this was not acceptable for them.</p><p>To make things worse, these were non-technical users who didn‚Äôt really grasp the cost of scanning the entire database. Our data is partitioned by time, so applying even a simple time filter could‚Äôve massively improved response time. But from their perspective: More data means always better answers <em>- even though i don&rsquo;t agree with this -</em> so they‚Äôd often remove the predefined time filters - not realizing the performance hit they were causing.</p><h2 id=vertical-scaling-wasnt-sustainable>Vertical scaling wasn‚Äôt sustainable</h2><p>There‚Äôs a <a href=https://research.google/blog/speed-matters/>popular saying in tech that &ldquo;a one-second delay can cost you 10% of your users.&rdquo;</a> Whether or not that number is exact, it reflects a real truth: users expect speed. As a result, many top engineers run oversized, underutilized servers - burning budget just to keep response times low. CPUs often idle at 1%, but hey, the latency graphs look good.</p><p>When we launched the observatory in November 2024, I set up the postgresql node type a bit higher - nothing fancy but the response time was improved. However, databases are expensive, and I couldn‚Äôt justify the cost in the long run. So after the launch buzz calmed down, I downgraded the instance to protect our infrastructure budget.</p><p>For months, I kept hearing minor complaints in meetings about slowness. Without being able to tackle this performance issue, the use case was too rare, and I had many other priorities. And it was &ldquo;only&rdquo; one minute of their time <em>- and mine sometimes and I use the platform too -</em> and the trick of the cache works for the majority.</p><p>But deep down, my ego was hurt and I knew this wasn‚Äôt sustainable either, especially for a project that‚Äôs here to last.</p><h2 id=using-materialized-views>Using materialized views</h2><p>Eventually, I&rsquo;ve been lucky enough to find a small window of time to work on this case, and successfully prototyped using Data Build Tool (DBT) to pre-calculate (using <a href=https://docs.getdbt.com/docs/build/materializations#materialized-view>a materialized view</a>) the first query displayed on the website : a percent of information linked to ecology in media by month.</p><p>Thanks to this PoC with automated tests, motivation due to my ego a bit hurt by months of &ldquo;website being slow&rdquo; complaints, and helped with the head of data of Quota Climat who identitied a generic root query, we could implement a materialized view on our 25GB of data.</p><p><strong>Result: custom query response times dropped from 60 seconds to 60 milliseconds ‚Äî a 1000x improvement, with zero additional infrastructure cost.</strong></p><p>The kind of solution I love: no money thrown at the problem, just smart modeling.</p><h2 id=thoughts-on-dbt>Thoughts on DBT</h2><p>DBT has clearly taken over a big slice of the modern data stack.</p><h3 id=-things-i-liked-about-it->‚úÖ Things I liked about it :</h3><ul><li>being able to quickly add seeds for my tests</li><li>the clear command lines without too many options</li></ul><h3 id=-things-i-disliked-about-it->‚ùå Things I disliked about it :</h3><ul><li><strong>developer experience:</strong> Coming from statically typed languages like Scala, it hurts to write untyped SQL and wait for runtime to catch errors. I know that‚Äôs standard in the Python world but I still wish for early error detection. Spark Scala&rsquo;s Dataset API based on Panda&rsquo;s DataFrame succesfully done it years ago by adding type safety :
<img src=https://www.java-success.com/wp-content/uploads/2018/08/Screen-Shot-2022-02-09-at-9.35.08-pm.png alt="SparkSQL Vs Dataframe Vs Dataset"></li><li>a bit messy to add <code>pytest</code>, but i&rsquo;m glad it works well</li></ul><p>Have a look to <a href=https://github.com/dataforgoodfr/quotaclimat/tree/main/my_dbt_project>my dbt project here</a> to comment or be inspired for your project.</p><h2 id=conclusion---eroom-law-for-the-win>Conclusion - erooM law for the win</h2><p>Performance doesn‚Äôt always need to mean scaling up and paying more. Sometimes, a deeper understanding of user behavior and smarter modeling is enough. In my case, I used partitioning, caching and pre-calculation with DBT and materialized views : <a href=https://blog.octo.com/la-loi-de-moore-est-morte-et-c%27est-une-bonne-nouvelle>erooM law for the win.</a></p></div><div class=post__footer></div></div></main></div><footer class="footer footer__base"><ul class=footer__list><li class=footer__item>&copy;
Copyleft (üÑØ) - CC-BY-SA</li></ul></footer><script type=text/javascript src=/js/medium-zoom.min.1248fa75275e5ef0cbef27e8c1e27dc507c445ae3a2c7d2ed0be0809555dac64.js integrity="sha256-Ekj6dSdeXvDL7yfoweJ9xQfERa46LH0u0L4ICVVdrGQ=" crossorigin=anonymous></script><script async src="https://www.googletagmanager.com/gtag/js?id=G-W1N7B2KENY"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-W1N7B2KENY")</script></body></html>