<!doctype html><html dir=ltr lang=en data-theme=dark><head>
<title>
Paul Leclercq ü¶ï
|
Analyze one year of radio station songs aired with SQL, Spark, Spotify, and Databricks
</title>
<meta charset=utf-8><meta name=generator content="Hugo 0.89.2"><meta name=viewport content="width=device-width,initial-scale=1,viewport-fit=cover">
<meta name=description content="
      One year of radio stations broadcasts were analyzed to notice their habits and if radio stations brainwashing is a thing


    ">
<link rel=stylesheet href=/blog/css/main.min.8775b48d3e2f42f24c3f855cf69173997d4189f352c2f7a2fbbf140df9bb63d6.css integrity="sha256-h3W0jT4vQvJMP4Vc9pFzmX1BifNSwvei+78UDfm7Y9Y=" crossorigin=anonymous type=text/css>
<link rel=stylesheet href=/blog/css/markupHighlight.min.058b31f17db60602cc415fd63b0427e7932fbf35c70d8e341a4c39385f5f6f3e.css integrity="sha256-BYsx8X22BgLMQV/WOwQn55MvvzXHDY40Gkw5OF9fbz4=" crossorigin=anonymous type=text/css>
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css integrity="sha512-+4zCK9k+qNFUR5X+cKL9EIR+ZOhtIloNl9GIKS57V1MyNsYpYcUrUeQc9vNfzsWfV28IaLL3i96P9sdNyeRssA==" crossorigin=anonymous>
<link rel="shortcut icon" href=/blog/favicons/favicon.ico type=image/x-icon>
<link rel=apple-touch-icon sizes=180x180 href=/blog/favicons/apple-touch-icon.png>
<link rel=icon type=image/png sizes=32x32 href=/blog/favicons/favicon-32x32.png>
<link rel=icon type=image/png sizes=16x16 href=/blog/favicons/favicon-16x16.png>
<link rel=canonical href=/blog/article/analyze-one-year-of-radio-station-songs-aired-with-sql-spark-spotify-and-databricks/>
<script type=text/javascript src=/blog/js/anatole-header.min.2a2cd9614b7d007dfbb75e8da19e3a0fa872ceab53c6d000c00b7a0c89b85bfc.js integrity="sha256-KizZYUt9AH37t16NoZ46D6hyzqtTxtAAwAt6DIm4W/w=" crossorigin=anonymous></script>
<script type=text/javascript src=/blog/js/anatole-theme-switcher.min.7fd87181cdd7e8413aa64b6867bb32f3a8dc242e684fc7d5bbb9f600dbc2b6eb.js integrity="sha256-f9hxgc3X6EE6pktoZ7sy86jcJC5oT8fVu7n2ANvCtus=" crossorigin=anonymous></script>
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Analyze one year of radio station songs aired with SQL, Spark, Spotify, and Databricks">
<meta name=twitter:description content="One year of radio stations broadcasts were analyzed to notice their habits and if radio stations brainwashing is a thing">
<meta property="og:title" content="Analyze one year of radio station songs aired with SQL, Spark, Spotify, and Databricks">
<meta property="og:description" content="One year of radio stations broadcasts were analyzed to notice their habits and if radio stations brainwashing is a thing">
<meta property="og:type" content="article">
<meta property="og:url" content="https://polomarcus.github.io/blog/article/analyze-one-year-of-radio-station-songs-aired-with-sql-spark-spotify-and-databricks/"><meta property="article:section" content="article">
<meta property="article:published_time" content="2017-03-20T14:41:06+02:00">
<meta property="article:modified_time" content="2017-03-20T14:41:06+02:00"><meta property="og:site_name" content="Paul Leclercq ü¶ï">
<script type=application/ld+json>{"@context":"http://schema.org","@type":"BlogPosting","articleSection":"article","name":"Analyze one year of radio station songs aired with SQL, Spark, Spotify, and Databricks","headline":"Analyze one year of radio station songs aired with SQL, Spark, Spotify, and Databricks","alternativeHeadline":"","description":"
      One year of radio stations broadcasts were analyzed to notice their habits and if radio stations brainwashing is a thing


    ","inLanguage":"fr-fr","isFamilyFriendly":"true","mainEntityOfPage":{"@type":"WebPage","@id":"https:\/\/polomarcus.github.io\/blog\/article\/analyze-one-year-of-radio-station-songs-aired-with-sql-spark-spotify-and-databricks\/"},"author":{"@type":"Person","name":"Paul Leclercq ü¶ï"},"creator":{"@type":"Person","name":"Paul Leclercq ü¶ï"},"accountablePerson":{"@type":"Person","name":"Paul Leclercq ü¶ï"},"copyrightHolder":{"@type":"Person","name":"Paul Leclercq ü¶ï"},"copyrightYear":"2017","dateCreated":"2017-03-20T14:41:06.00Z","datePublished":"2017-03-20T14:41:06.00Z","dateModified":"2017-03-20T14:41:06.00Z","publisher":{"@type":"Organization","name":"Paul Leclercq ü¶ï","url":"https://polomarcus.github.io/blog/","logo":{"@type":"ImageObject","url":"https:\/\/polomarcus.github.io\/blog\/favicons\/favicon-32x32.png","width":"32","height":"32"}},"image":[],"url":"https:\/\/polomarcus.github.io\/blog\/article\/analyze-one-year-of-radio-station-songs-aired-with-sql-spark-spotify-and-databricks\/","wordCount":"2847","genre":[],"keywords":["spark","databricks","SQL"]}</script>
</head>
<body>
<header><div class="page-top
animated fadeInDown">
<a role=button class=navbar-burger data-target=navMenu aria-label=menu aria-expanded=false>
<span aria-hidden=true></span>
<span aria-hidden=true></span>
<span aria-hidden=true></span>
</a>
<nav>
<ul class=nav__list id=navMenu>
<div class=nav__links>
<li>
<a href=/blog/ title>Home</a>
</li>
<li>
<a href=/blog/article/ title>Articles</a>
</li>
<li>
<a href=/blog/tags/ title>Categories | Tags</a>
</li>
</div>
<ul>
<li>
<a class=theme-switch title="Switch Theme">
<i class="fas fa-adjust fa-fw" aria-hidden=true></i>
</a>
</li>
</ul>
</ul>
</nav>
</div>
</header>
<div class=wrapper>
<aside><div class="sidebar
animated fadeInDown">
<div class=sidebar__content>
<div class=logo-title>
<div class=title>
<img src="https://avatars.githubusercontent.com/u/4059615?v=4" alt="profile picture">
<h3 title><a href=/blog>Paul Leclercq ü¶ï</a></h3>
<div class=description>
<p>"Des nains sur des √©paules de g√©ants" - Bernard de Chartres<br><br>Data, climat, sports, cong√© paternit√©<br></p>
</div>
</div>
</div>
<ul class=social-links>
<li>
<a href=https://www.github.com/polomarcus rel=me aria-label=Github>
<i class="fab fa-github fa-2x" aria-hidden=true></i>
</a>
</li>
<li>
<a href=https://www.linkedin.com/in/paleclercq/ rel=me aria-label=Linkedin>
<i class="fab fa-linkedin fa-2x" aria-hidden=true></i>
</a>
</li>
<li>
<a href=https://twitter.com/polomarcus rel=me aria-label=Twitter>
<i class="fab fa-twitter fa-2x" aria-hidden=true></i>
</a>
</li>
<li>
<a href=https://medium.com/@polomarcus rel=me aria-label=Medium>
<i class="fab fa-medium fa-2x" aria-hidden=true></i>
</a>
</li>
</ul>
</div><footer class="footer footer--sidebar">
<div class=by_farbox>
<ul class=footer__list>
<li class=footer__item>
&copy;
Paul Leclercq ü¶ï
2021
</li>
</ul>
</div>
</footer>
<script type=text/javascript src=/blog/js/medium-zoom.min.71100d84fab0ad794b8399a66ac810700cc78d703f715dc10af4d7ba7b761362.js integrity="sha256-cRANhPqwrXlLg5mmasgQcAzHjXA/cV3BCvTXunt2E2I=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W1N7B2KENY"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-W1N7B2KENY')</script>
</div>
</aside>
<main>
<div class=autopagerize_page_element>
<div class=content>
<div class="post
animated fadeInDown">
<div class=post-content>
<div class=post-title>
<h1>Analyze one year of radio station songs aired with SQL, Spark, Spotify, and Databricks</h1>
</div><p><em>Note: This post was originally published on <a href=https://medium.com/@polomarcus/analyze-one-year-of-radio-station-songs-aired-with-sql-spark-spotify-and-databricks-835fcf73df6#.7o1uwd9vc>Medium</a></em></p>
<p>Whenever I drive or code, I listen to music, as this happens a lot, and in order to find new songs, I listen to the radio or I listen to Spotify&rsquo;s discover weekly playlist, <em>which made me like Mondays (because they release it every Monday)</em></p>
<p>A french <em>old-school</em> institute called <a href=http://www.mediametrie.fr/radio/>Mediam√É¬©trie</a> analyzes radio stations' songs. Since I have seen their study (<em>that I can&rsquo;t find anymore</em>) some years ago, I have been obsessed with creating my own.</p>
<p><img src=https://cdn-images-1.medium.com/max/800/1*aic7vTL46SYNhhkdHgir9Q.png alt></p>
<p>This article will present the year 2016 for 4 main french radio stations through <em>fun</em> SQL queries, then we will connect each song to the Spotify API to create the radio stations' musical profile.</p>
<p>We will use the <a href=https://community.cloud.databricks.com/>Databricks community version</a> to visualize our data. <a href=https://databricks-prod-cloudfront.cloud.databricks.com/public/4027ec902e239c93eaaa8714f173bcfc/6937750999095841/1807085967979471/6197123402747553/latest.html>All SQL queries and all results are available on this notebook.</a> It&rsquo;s the ‚Äúbackstage‚Äù of this article, where the magic happens if we can say.</p>
<p><strong>Protip</strong>: don&rsquo;t miss the bonuses at the end of the article</p>
<h3 id=radio-stations-introduction>Radio stations introduction</h3>
<p>We all have a favorite radio station, mine is <a href=https://en.wikipedia.org/wiki/Radio_Nova_%28France%29>Radio Nova</a> for their diversity, their humor, and as a hip hop fan this is the only national radio where we can hear <em>listenable</em> hip hop songs</p>
<p><img src=https://cdn-images-1.medium.com/max/800/0*nKeR6DQGjRIQj5a7.png alt></p>
<p>Radio nova had<a href="http://www.mediametrie.fr/radio/communiques/telecharger.php?f=b132ecc1609bfcf302615847c1caa69a"> 1,4% of the audience in September 2016 (PDF to download from Mediametrie)</a>.</p>
<p><img src=https://cdn-images-1.medium.com/max/800/1*_g363O12zm0KugNa_qcQ0g.png alt></p>
<p>In order to see how a radio becomes number 1, we are also going to analyze the number 1 music radio called <a href=http://www.nrj.fr/>NRJ </a>who has 10,8% of the audience and 2 others : Virgin (5%) which, we&rsquo;ll see, sounds like NRJ, and Skyrock (6%), <em>don&rsquo;t mind the name it&rsquo;s a rap radio‚Ä¶ haha</em></p>
<p><img src=https://cdn-images-1.medium.com/max/800/1*iKd8P0iu3oe6C_iOYeYeAA.png alt></p>
<p>The main question is, after we compared these radios, should we give to Radio Nova the tips of how to be the number one based on NRJ&rsquo;s analyze? <em>What do you say, Nova? Learn from the best, right?!</em></p>
<h3 id=getting-the-radios-songs-data>Getting the Radio&rsquo;s songs data</h3>
<p><img src=https://cdn-images-1.medium.com/max/800/1*l8ljCalKR3Tpnpp9ZM9Kbg.png alt></p>
<p>In order to extract the songs lists, artist, song title and timestamp, we are going to parse each Radio ‚ÄúWhat was this song?‚Äù HTML pages, except for Skyrock which <a href="http://skyrock.fm/api/v3/sound?search_date=2016-08-15&search_hour=04:59">has a handy RESTful web service</a>.</p>
<p>Every song extracted will be converted into this Song class to query them easily with (Spark) SQL:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-java data-lang=java>    Song<span style=color:#f92672>(</span>timestamp<span style=color:#f92672>:</span>Int<span style=color:#f92672>,</span> humanDate<span style=color:#f92672>:</span>Long<span style=color:#f92672>,</span> year<span style=color:#f92672>:</span>Int<span style=color:#f92672>,</span> month<span style=color:#f92672>:</span>Int<span style=color:#f92672>,</span> day<span style=color:#f92672>:</span>Int<span style=color:#f92672>,</span> hour<span style=color:#f92672>:</span>Int<span style=color:#f92672>,</span> minute<span style=color:#f92672>:</span> Int<span style=color:#f92672>,</span> artist<span style=color:#f92672>:</span>String<span style=color:#f92672>,</span> allArtists<span style=color:#f92672>:</span> String<span style=color:#f92672>,</span> title<span style=color:#f92672>:</span>String<span style=color:#f92672>)</span>
</code></pre></div><p>In 2016 300K broadcasts were collected:</p>
<ul>
<li>Nova : 95K broadcasts of 5000 different songs</li>
<li>NRJ : 50K broadcasts of 800 different songs</li>
<li>Virgin: 60K broacasts of 1200 different songs</li>
<li>Skyrock: 100K broadcasts of 1000 different songs</li>
</ul>
<p>Every songs is stored in a <a href=http://spark.apache.org/docs/latest/sql-programming-guide.html#parquet-files>parquet format</a> to extract only once the data (<em>you&rsquo;re welcome radios servers :p</em>) and <a href=https://blog.cloudera.com/blog/2016/04/benchmarking-apache-parquet-the-allstate-experience/>to speed up SparkSQL queries</a>. <em>Btw, if you are interested by the file I can export it to you in CSV, or parquet.</em></p>
<p>Remember that the best way to speed up, the <a href=http://spark.apache.org/docs/latest/programming-guide.html#rdd-persistence>Spark doc</a> says often by more than 10x, queries, if you have to use the same SQL table (or Dataset/Dataframe) again and again, is to cache them in memory (<em>Thanks Databricks for the 6Go RAM server!</em>) with the <code>dataframe.cache()</code> method.</p>
<p>Let&rsquo;s dive into our analysis now !</p>
<h3 id=how-many-songs-by-day>How many songs by day?</h3>
<p><em>Some days were not recorded by the radios' history system, so the real numbers should be a bit higher.</em></p>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*0tYTwHCCN6r2nq6EqJojdA.png alt></p>
<p>Fun to see that both radio stations broadcast more songs during summer (if we do not take in consideration the one-week bug of Radio Nova, in blue, in August), this is certainly due to summer holidays. <em>They do a good job all year long, so, it&rsquo;s OK to take some days off, I guess!</em></p>
<p>We can see that Skyrock and Nova broadcasts the same number of songs each day, whereas NRJ and Virgin a bit less, certainly due to more talk shows or untracked DJs night shows.</p>
<h3 id=how-many-different-songs-by-day>How many different songs by day?</h3>
<p>The real difference comes from the number of different songs played, see by yourself the number of different tracks per day:</p>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*Omx2QwvONBJMBLmUOtD5Pw.png alt></p>
<p>More mainstream radios such as NRJ, Virgin and Skyrock top 100/120 different songs a day whereas Nova is more about 280. If you want to discover more songs, it&rsquo;s clearly on Nova.</p>
<h3 id=how-many-different-songs-by-month>How many different songs by month?</h3>
<p>If we have a look to the monthly different songs, the gap between radios is even bigger.</p>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*7WL3--Hb00WNPvjeM5if8w.png alt></p>
<h3 id=top-10-played-titles-by-each-radio-station>Top 10 played titles by each radio station</h3>
<p>It&rsquo;s interesting to see how ‚Äúhits‚Äù are played through the year.</p>
<p>We can notice summer hits:</p>
<ul>
<li><a href=https://open.spotify.com/track/0EM0yABJzbFOvZQkfvuvCy>Kaytranada</a> for Nova</li>
<li><a href=https://open.spotify.com/track/6YZdkObH88npeKrrkb8Ggf>Enrique Iglesias</a> for NRJ</li>
<li><a href=https://open.spotify.com/track/27PmvZoffODNFW2p7ehZTQ>Kent Jones</a> and <a href=https://open.spotify.com/track/1xznGGDReH1oQq0xzbwXa3>Drake</a> for Skyrock</li>
<li><a href=https://open.spotify.com/track/1ZdWNpOXCJT1nmt40UuxWS>Imany</a> and <a href=https://open.spotify.com/track/0cAuqPI1R8RlFsXXWWO039>Kungs</a> for Virgin.</li>
</ul>
<p>We can tell that the most broadcasted songs are mostly aired during summer. So artists, play smart here and release your songs between February and June to have more chance to become number one, <em>or to have more people hating your music because they heard it too many times?</em></p>
<h4 id=nova>Nova</h4>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*9mum9beXiQln5uSyfy2yww.png alt></p>
<h4 id=nrj>NRJ</h4>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*awiIMX1Bwu5rdS-_rkeeYg.png alt></p>
<h4 id=skyrock>Skyrock</h4>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*Z4KvMZzWL7ltwtjwMM5Nkw.png alt></p>
<h4 id=virgin>Virgin</h4>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*nZMYiYJttXEOaV7KugtjHA.png alt></p>
<h3 id=percentage-of-music-by-day>Percentage of music by day</h3>
<p>If we take the average broadcasted songs by day and the mean duration of a song, 3.30 minutes, we can guess the percentage of music by day. The other percentage is likely to be talk shows, advertising or untracked songs.</p>
<p><img src=https://cdn-images-1.medium.com/max/800/1*xAIRqQ96Leq1zSD--o4akA.png alt></p>
<p>To understand more these percentages, we should see what a normal day is for our analyzed radio stations.</p>
<h3 id=what-is-a-typical-monday-for-our-radio-stations>What is a typical Monday for our radio stations?</h3>
<p>Let&rsquo;s have a look to the average of number of songs for all radio stations for Mondays</p>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*e3ev4GNUCtKPcnq9SmgoFA.png alt></p>
<p>We can distinguish 2 gaps, during the morning and evening shows for every radio stations. <em>Amazing.</em> More seriously, no discovery here, it&rsquo;s a known fact that most radios have morning and evening shows during which there is less music and more talk.</p>
<h4 id=advertising-time>Advertising time</h4>
<p>If we recalculate the average percentage of music at noon, when there is no shows for all radio stations, we can estimate the percentage of advertising by radio by hour. We estimate that the radio hosts speak 5 minutes during the whole hour. <em>We have to note that radios may advertise more during prime time when they have a larger audience.</em></p>
<p>For 60 minutes, we get from 7 minutes of advertising time, for Skyrock, to 15 minutes, for Virgin. In details, we have this table:</p>
<p><img src=https://cdn-images-1.medium.com/max/1000/1*VcuOm-luXT_e_q6d-5q9Zg.png alt></p>
<h3 id=radios--brainwashing>Radios brainwashing?</h3>
<p>An annoying feeling we have sometimes with radios is we keep listening to the same songs over and over. As we are men and women who believe in science and not in our instinct we are going to use basic statistics to verify this weird feeling.</p>
<h4 id=how-many-times-is-the-same-song-aired-on-the-same-day>How many times is the same song aired on the same day?</h4>
<p><img src=https://cdn-images-1.medium.com/max/800/1*Ahz21it10spW3txOSnPJew.png alt></p>
<p>These pie charts below tells us a lot about radio stations&rsquo;s habits, more mainstream radios such as Virgin, NRJ or Skyrock are more about to broadcasts the same songs multiple times.</p>
<p><img src=https://cdn-images-1.medium.com/max/1000/1*t-xKlfHx8j5fWBSG5epeaw.png alt></p>
<h4 id=when-is-the-next-time-we-will-listen-to-the-same-song-during-the-same-day>When is the next time we will listen to the same song during the same day?</h4>
<p><img src=https://cdn-images-1.medium.com/max/1000/1*S-baYaxkztVV7znKPKYRhQ.png alt></p>
<p>Again, the most mainstream radios, NRJ, Skyrock and Virgin tend to broadcast the same song most often 2/3 hours since it was first aired. Nova&rsquo;s value is more about 7/8 hours.</p>
<p>While we have different distribution, the average for our 4 radios is between 7 and 8 hours.</p>
<p><img src=https://cdn-images-1.medium.com/max/800/1*Ve3UMz8tRiDVmVnca4vVUw.png alt></p>
<h4 id=how-many-new-songs-are-added-and-when>How many new songs* are added and when?</h4>
<p>*‚ÄúNew songs‚Äù means songs that are not yet broadcasted in 2016.</p>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*5PC0QuOvyDTStuoDK7zzXw.png alt></p>
<p>If we look at the average after April 2016, we see that&rsquo;s Nova is ahead, but don&rsquo;t forget Nova plays 2500 different songs each month, so it&rsquo;s normal statistically speaking</p>
<p><img src=https://cdn-images-1.medium.com/max/800/1*NZfug_TEvZQhUR3zargkmA.png alt></p>
<p>New songs are distributed equally along the week for all radios</p>
<p><img src=https://cdn-images-1.medium.com/max/800/1*hwwdZoj1GRNnWuW7LokE7w.png alt></p>
<h3 id=common-songs-between-radio-stations>Common songs between radio stations</h3>
<p>On the table below, we can see NRJ has 25% of common songs with Virgin and 12% with Skyrock.</p>
<p>Virgin has 18% with NRJ while Skyrock has 9% of common songs with NRJ.</p>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*w1sB-Z8zzoP19Lsg2V-U8A.png alt></p>
<p>Nova has a few similar songs with the others radio, there are mostly legendary artists such as Bob Marley, Daft Punk, Aloe Blacc, Kavinsky, Beyonc√É¬©‚Ä¶ If you are interested by the full list look for the ‚ÄúSimilar songs between radios‚Äù cell in <a href=https://databricks-prod-cloudfront.cloud.databricks.com/public/4027ec902e239c93eaaa8714f173bcfc/6937750999095841/1807085967979471/6197123402747553/latest.html>the ‚Äúbackstage‚Äù AKA the blog article&rsquo;s Databricks notebook</a></p>
<p>Our 4 radio stations are different, for sure, but do they have common songs between them? Surprisingly the answer is yes</p>
<ul>
<li><a href=https://open.spotify.com/track/28S2K2KIvnZ9H6AyhRtenm>Prince ‚Äì Kiss</a></li>
<li><a href=https://open.spotify.com/track/255uSDEuvkWp1QyYnm82VJ>C2C ‚Äì Happy</a></li>
<li><a href=https://open.spotify.com/track/4z70Px77quweOupQRiaG2Q>Stromae ‚Äì Formidable</a></li>
</ul>
<p>I would classify these songs as songs that everybody likes, <em>you can play them at your party without any stress of being booed</em></p>
<p>If we use a visualization for our previous table it will look like this, the blue bar is the similar songs, the orange and the green bar are the total of different songs.</p>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*XnAgFeqhykf0mhYurSKXJg.png alt></p>
<h3 id=what-are-the-secrets-to-be-1>What are the secrets to be #1?</h3>
<p>We have analyzed 4 radio stations based on the artist name, the title name and the day and time the songs were broadcasted. Beside letters and numbers, these 3 values mean nothing, if we want to make a deeper analyze we have to learn more about the songs played: how popular is the song right now? what is the genre of the song? How many followers does the artist have?</p>
<p>Hopefully, by connecting each song to the Spotify API we will get a lot of data we can play with :</p>
<blockquote>
<p><a href="https://api.spotify.com/v1/search?q=$encodedQuery&type=track&limit=1">https://api.spotify.com/v1/search?q=ARTISTTITLE&type=track&limit=1</a></p>
</blockquote>
<p>In 2016, we have collected 8000 different songs from the radios, so to get the artist, the track and the tracks' audio features from the Spotify API we have to make :</p>
<blockquote>
<p>Number of songs x (<a href=https://developer.spotify.com/web-api/console/get-artist/>Artist</a> + <a href=https://developer.spotify.com/web-api/console/get-track/>track</a> + <a href=https://developer.spotify.com/web-api/console/get-audio-features-track/>audiofeatures</a>) = 24K requests</p>
</blockquote>
<p><img src=https://cdn-images-1.medium.com/max/800/0*j0EeLA19ElJmN_ae.jpg alt></p>
<p>That&rsquo;s a lot. Plus, Spotify has a limit of request in time, so we have got to do it slowly, 20 request every 2 seconds, <em>why not you know.</em></p>
<p>BUT, with this slow rate one thing I didn&rsquo;t plan is we could see the number of followers change when we requested a song&rsquo;s artist, as most artists have multiple songs been broadcasted, the artist information was asked from twice to 10 times. <em>No problemo, right?</em> No‚Ä¶This will mess up our SQL join between artist and track data later just because the DISTINCT on artists information <a href="https://www.youtube.com/watch?v=1IDF-8khS3w">were fake</a> due to <code>followers.total</code></p>
<p><em>I have to say this led me to craziness, because I had more songs after my join than before haha</em></p>
<p><img src=https://cdn-images-1.medium.com/max/800/1*UlBp9dA-JJyY3aJ-klrsBg.png alt></p>
<h3 id=songs-popularity-by-radio>Songs Popularity By Radio</h3>
<h4 id=definition-by-spotify>Definition by Spotify</h4>
<blockquote>
<p>The popularity is calculated by algorithm and is based, in the most part, on the total number of plays the track has had and how recent those plays are.</p>
</blockquote>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*vVSuuElWOqbngrTlj4SNdw.png alt></p>
<p>No surprises here, mainstream radios NRJ, Virgin or Skyrock, tend to play more popular songs, <em>that&rsquo;s why I use the term mainstream, clever, right?</em></p>
<p><img src=https://cdn-images-1.medium.com/max/800/1*FwnhWdDxbYIQ_YhIjkLspA.png alt></p>
<p><em>But the real question is : was the song popular before it was broadcasted on the radio?</em></p>
<h3 id=audio-features>Audio features</h3>
<p>The Spotify API gives <a href=https://developer.spotify.com/web-api/get-audio-features/#tablepress-215>audio features extracted from the Song&rsquo;s soundwaves</a>, thanks to these we can display a musical profile of each radio:</p>
<p><a href="https://www.youtube.com/watch?v=pWdd6_ZxX8c">In my opinion</a>, the most meaningful audio features are :</p>
<ul>
<li>danceability <em>describes how suitable a track is for dancing based on a combination of musical elements including tempo, rhythm stability, beat strength, and overall regularity.</em></li>
<li>energy <em>is a measure from 0.0 to 1.0 and represents a perceptual measure of intensity and activity. Typically, energetic tracks feel fast, loud, and noisy.</em></li>
<li>valence <em>describes the musical positiveness conveyed by a track. Tracks with high valence sound more positive (e.g. happy, cheerful, euphoric), while tracks with low valence sound more negative (e.g. sad, depressed, angry).</em></li>
</ul>
<p>Let&rsquo;s see their average and their distribution, <em>as a average alone can be sometimes misleading</em>, among the radios' tracks. As Nova got more different songs than the others we are going use percentage to compare our radios to add more context to our stats.</p>
<p><a href=https://medium.com/@polomarcus/my-facebook-interview-journey-5205e111155f#.r3w705wo3>If you have read my Facebook Interview Journey,</a> you know this is where I failed during my SQL interview, this code is specially for you, dear Mr. Interviewer, no hard feelings though :p</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sql data-lang=sql><span style=color:#66d9ef>SELECT</span> ROUND( (<span style=color:#66d9ef>COUNT</span>(t.<span style=color:#f92672>*</span>) <span style=color:#f92672>/</span> subTotal.total_radio <span style=color:#f92672>*</span> <span style=color:#ae81ff>100</span>),<span style=color:#ae81ff>2</span>) <span style=color:#66d9ef>AS</span> percentage_of_songs,
      subTotal.total_radio,
      ROUND(popularity <span style=color:#f92672>/</span> <span style=color:#ae81ff>10</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>10</span> <span style=color:#66d9ef>AS</span> popularity,
      t.radio
<span style=color:#66d9ef>FROM</span> AudioFeatureArtistTrackRadios t
<span style=color:#66d9ef>JOIN</span> (
    <span style=color:#66d9ef>SELECT</span> <span style=color:#66d9ef>COUNT</span>(<span style=color:#f92672>*</span>) <span style=color:#66d9ef>AS</span> total_radio, radio
    <span style=color:#66d9ef>FROM</span> AudioFeatureArtistTrackRadios
    <span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> radio
) <span style=color:#66d9ef>AS</span> subTotal
<span style=color:#66d9ef>ON</span> subTotal.radio <span style=color:#f92672>=</span> t.radio
<span style=color:#66d9ef>GROUP</span> <span style=color:#66d9ef>BY</span> subTotal.total_radio, ROUND(popularity <span style=color:#f92672>/</span> <span style=color:#ae81ff>10</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>10</span>, t.radio
<span style=color:#66d9ef>ORDER</span> <span style=color:#66d9ef>BY</span> popularity
</code></pre></div>
<h4 id=energy>Energy</h4>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*Y20xDfW6m6x4PQ-gdtMouA.png alt></p>
<p>Mainstream radios tend to play more energetic songs, <em>I guess there are more easy to listen to?</em> Some example of song with a lot of energy are <a href=https://open.spotify.com/track/6Unf6X6PC7KZtrRXH3dFHg>We Are Your Friends - JUSTICE</a>, <a href=https://open.spotify.com/track/7yI4qKGEFHNId1B893XopS>Steppin' stone - Davy Jones</a>, and of course, the classics from the classics <a href=https://open.spotify.com/track/1bx7OUl2UmAnA5oZkm9If7>Jerk It Out ‚Äì Caesars</a>, I&rsquo;ve first heard it while playing <a href="https://www.youtube.com/watch?v=-0x3aZEPcMA">SSX3 on GameCube</a> 8)</p>
<p><img src=https://cdn-images-1.medium.com/max/800/1*IySsIzTaReMzd1OZ9PxXWw.png alt></p>
<h4 id=danceability>Danceability</h4>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*P4erZSV3quz3__oR2c24bA.png alt></p>
<p>This chart tells us both radio broadcasts the same kind of danceable songs. Some example of danceable song are <a href=https://open.spotify.com/track/3aImJnJlAgcE7bJ1NxthGt>Trick Me ‚Äì Kelis</a>, <a href=https://open.spotify.com/track/1pKYYY0dkg23sQQXi0Q5zN>Around the world ‚Äì Daft Punk</a> or <a href="https://www.youtube.com/watch?v=LDZX4ooRsWs">Anaconda ‚Äì Nicki Mina</a></p>
<p><img src=https://cdn-images-1.medium.com/max/800/1*JpPrbAzb0U13iMZK7PihXQ.png alt></p>
<h4 id=valence--positiveness>Valence / Positiveness</h4>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*ujgMyDVxmhj2YlgfIM11HA.png alt></p>
<p><img src alt></p>
<p>Same as the danceability, both radio broadcasts the same kind of positive tracks. Some examples : <a href=https://open.spotify.com/track/5nNmj1cLH3r4aA4XDJ2bgY>September ‚Äì Earth Wind & Fire</a>,<a href=https://open.spotify.com/track/4BLu47sbjr3aJZwxZujgXT>Ska-Boo-Da-Ba ‚Äì The Skatalites</a> or <a href=https://open.spotify.com/track/5WQ1hIc5d2EVbRQ8qsj8Uh>Hey Ya! ‚Äì OutKast</a></p>
<p><img src=https://cdn-images-1.medium.com/max/800/1*Jaa8mmCC84LsxskMJjbuNg.png alt></p>
<p>2 others interesting data, which are not Spotify (<a href=http://the.echonest.com/>Echo Nest</a>) specific, are the BPM (beats per minute) and the songs duration</p>
<h4 id=tempo--beats-per-minute>Tempo / Beats per minute</h4>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*Xkq3Q3yjJaNowJkhzXP1FA.png alt></p>
<h4 id=duration>Duration</h4>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*67Kr4JwQOCrc2u6Obz3nMg.png alt></p>
<p>Nova seems to be a bit different from the other radios by playing shorter or longer tracks. Virgin, NRJ and Skyrock are really into 3-minute tracks.</p>
<p>When I first saw this graph, I couldn&rsquo;t help myself to think about this <a href=https://open.spotify.com/track/1DhpyURGQ8gAQCYo8dOLQo>Hocus Pocus' song called ‚ÄúVoyage immobile</a>‚Äù (motionless journey) and this sentence about our undiversified musical environment :</p>
<blockquote>
<p>‚ÄúJe ne voyais que blocs longs de 3 minutes taill√É¬© dans le roc et dans le m√É¬™me but‚Äù</p>
</blockquote>
<blockquote>
<p>‚ÄúI could only see 3-minute blocks from the same base with the same goal‚Äù</p>
</blockquote>
<p><img src=https://cdn-images-1.medium.com/max/800/1*fpld7Zi9lOJDPKWDdrcFpw.png alt></p>
<h3 id=music-genres>Music genres</h3>
<p><img src=https://cdn-images-1.medium.com/max/1000/1*sgT6naW21Wu0M7sYaL2qMQ.png alt></p>
<p>Spotify got some pretty weird music genres, have you noticed ‚Äúpost-teen pop‚Äù, ‚Äúpop christmas‚Äù, <em>pop songs you listen during christmas I guess? haha</em></p>
<p>We can clearly see that NRJ and Virgin, <em>which are very alike</em>, are more about pop/dance/electro music, their top 3 genres are : pop, dance pop and tropical house. Nova is about soul, funk and indie music, and Skyrock is more about rap, dance and pop</p>
<p><img src=https://cdn-images-1.medium.com/max/800/1*_5E7highTXSqJ8rS7oFI0Q.png alt></p>
<h4 id=hip-hop-genres>Hip hop genres</h4>
<p><img src=https://cdn-images-1.medium.com/max/800/0*58-RGcDqjhx8XLD3.jpg alt></p>
<p>Skyrock is famous for its motto ‚Äú1st on Rap‚Äù, let&rsquo;s compare Hip hop/Rap genres (genres with ‚Äúrap‚Äù, ‚Äúhip‚Äù or ‚Äúhop‚Äù inside the name) with the others radios.</p>
<p><img src=https://cdn-images-1.medium.com/max/800/1*OGs_m824iH2tMza0ziY8JQ.png alt></p>
<p>OK, that&rsquo;s a close match between Skyrock and Nova, let&rsquo;s compare the internal hip hop genres now.</p>
<p>I don&rsquo;t really care about genres, but there are a lot of confusion between Hip hop, which is a culture, and rap, which is the actual fact of rapping, if you want to learn more check this <a href=https://en.wikipedia.org/wiki/Hip_hop#Culture>Wikipedia Chapter</a>, I also recommend the excellent <a href=https://www.netflix.com/title/80141782>Netflix&rsquo;s documentary ‚ÄúEvolution of Hip Hop‚Äù</a></p>
<p><img src=https://cdn-images-1.medium.com/max/2000/1*AsTuELi8z5QUmnG25FfUmA.png alt></p>
<p>Nova, in orange, is more about indie/alternative/undergroup hip hop music, and Skyrock, in blue, is really more into French rap/trap/hiphop and also popular rap. So let&rsquo;s fix Skyrock&rsquo;s motto by ‚Äú1st on French rap‚Äù haha</p>
<h3 id=music-classifier-for-radios-selection-idea>Music classifier for Radios' selection idea</h3>
<p><a href=https://medium.com/@polomarcus/music-recommendation-service-with-the-spotify-api-spark-mllib-and-databricks-7cde9b16d35d>In my last article</a>, I explained how to create your own music recommendation system thanks to these audio features.</p>
<p>A <a href=https://en.coursera.org/learn/progfun1>fun project</a> (<em>the link is a tribute to the Scala Guru <a href=https://medium.com/u/9a80872a98bb>Martin Odersky</a>, he tends to say too many times that his Scala exercises are fun whereas they are brain melt haha</em>) would be to create an algorithm that will help music selectors to find radios style&rsquo;s songs.</p>
<h4 id=spotify-recommendation-system>Spotify recommendation system</h4>
<p>Spotify&rsquo;s system is not only based on the audio features we saw earlier. It also analyzes what others similar users listen to. This slide contains a <a href=http://www.slideshare.net/sinisalyh/scala-data-pipelines-spotify/5-Recommendation_systems>nice schema that explains their whole system.</a></p>
<h3 id=whats-next>What&rsquo;s next?</h3>
<p>Thanks to this project I have built solid foundations to query the Spotify API in Scala, process it thanks to Spark SQL, and visualize it thanks to Databricks. I think more projects are about to come, plus Spotify has just released, March 2017, this new endpoint <a href=https://developer.spotify.com/news-stories/2017/03/01/new-endpoint-recently-played-tracks/>‚ÄúRecently Played Tracks‚Äù</a> and ideas are coming.</p>
<h3 id=databricks-pros-and-cons>Databricks pros and cons</h3>
<h4 id=pros>Pros</h4>
<ul>
<li>Free community edition with 6Go RAM server</li>
<li>Awesome and easy-to-use <a href=https://docs.databricks.com/user-guide/visualizations/index.html>Data Viz</a></li>
</ul>
<h4 id=cons-or-more-what-can-be-better>Cons (or more, what can be better)</h4>
<ul>
<li>Can only visualize a maximum of 10 elements when using a GROUP BY, the others elements go to one category called ‚ÄúOthers‚Äù</li>
<li>Not possible to choose the color of an entity, so a Radio can be blue on a graph and red on another, it can be sometimes confusing</li>
<li>Cannot export graph as iframe, so we have to export pictures from the interactive graphs</li>
<li>Cannot modify SQL on the Data Viz interface</li>
</ul>
<h3 id=thanks>Thanks</h3>
<ul>
<li><strong>Databricks</strong>, for their awesome platform</li>
<li><strong>Spotify</strong>, for their easy-to-use API and their <strong>human-readable</strong> documentation</li>
<li><a href=http://www.novaplanet.com/>Radio Nova</a> for being a top music <a href="http://www.urbandictionary.com/define.php?term=selecta">selecta</a>, I would not listen to the same music that I listen to today without you</li>
<li><a href=https://twitter.com/m_hlimi>Marc H&rsquo;LIMI</a>, Radio Nova&rsquo;s advisor, for our exchanges</li>
<li>Pierre Trussart, engineer and DJ, <a href=https://twitter.com/b_thuillier>Benjamin Thuillier</a>, scala rockstar, Nicolas Duforet, data science master, Justine Mouron, engineer</li>
<li>My friends for hearing me talking about this project too often</li>
</ul>
<h3 id=bonus--spotify-playlists>Bonus ‚Äì Spotify Playlists</h3>
<p>To thank for reading, I created 4 playlists of the most ~200 songs broadcasted sorted by the number of broadcast for :</p>
<ul>
<li><a href=https://open.spotify.com/user/cpolos/playlist/64DWZ46dFb50FaWs9eALIu>Nova with Calipso Rose, Brisa Roch√É¬©, Kaytranada, The Roots, M.I.A, The Virgins‚Ä¶</a></li>
<li><a href=https://open.spotify.com/user/cpolos/playlist/0x2SJgvfcBzxfiMTDkTuC4>Skyrock with Drake, Alonzo, Major Lazer, Timberlake, Soprano, PNL, Jul</a>‚Ä¶</li>
<li><a href=https://open.spotify.com/user/cpolos/playlist/3ySBdFmKboUlMWfqSpLZio>Virgin with Imany, Twenty One Pilots, Sia, Kungs, Julian Perretta</a>‚Ä¶</li>
<li><a href=https://open.spotify.com/user/cpolos/playlist/7ECHPNZ5fjLggN2rg0poK3>NRJ with Enrique Iglesias, Soprano, Coldplay, Kungs, Amir, MHD, Tal</a>‚Ä¶</li>
</ul>
</div>
<div class=post-footer>
<div class=info>
<span class=separator><a class=tag href=/blog/tags/spark/>spark</a><a class=tag href=/blog/tags/databricks/>databricks</a><a class=tag href=/blog/tags/sql/>SQL</a></span>
</div>
</div>
</div>
</div>
</div>
</main>
</div><footer class="footer footer--base">
<div class=by_farbox>
<ul class=footer__list>
<li class=footer__item>
&copy;
Paul Leclercq ü¶ï
2021
</li>
</ul>
</div>
</footer>
<script type=text/javascript src=/blog/js/medium-zoom.min.71100d84fab0ad794b8399a66ac810700cc78d703f715dc10af4d7ba7b761362.js integrity="sha256-cRANhPqwrXlLg5mmasgQcAzHjXA/cV3BCvTXunt2E2I=" crossorigin=anonymous></script>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-W1N7B2KENY"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-W1N7B2KENY')</script>
</body>
</html>